<!DOCTYPE html>
<html>
<head>
    <title>RIFF</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        .heading-logo {
            height: 80px;
        }
        .content {
            padding: 10px 20px;
        }
        .heading-container {
            gap: 10px;
            display: flex;
            justify-content: flex-end;
        }
        #main-heading {
            font-size: 32px;
            margin: 10px 0 0 0;
        }
        .top-left-logo {
            position: absolute;
            top: 80px;
            left: 20px;
            height: 140px;
            z-index: 100;
        }
        .map-rectangle {
            width: 60%;
            max-width: 900px;
            height: 750px;
            border: 2px solid #333;
            margin-top: 30px;
            margin-left: 0;
            position: relative;
            flex-shrink: 0;
        }
        #map {
            width: 100%;
            height: 100%;
        }
        .toggle-button {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
            background: white;
            border: 1px solid #ccc;
            padding: 5px 10px;
            font-size: 12px;
            cursor: pointer;
        }
        .igs-rectangle {
            width: 35%;
            max-width: 400px;
            height: 730px;
            background-color: rgb(255, 255, 255);
            border: 2px solid #ffffff;
            margin-top: 30px;
            margin-left: 0;
            overflow-y: auto;
            padding: 10px;
            flex-shrink: 0;
        }
        .location-list {
            font-size: 12px;
            line-height: 1.4;
        }
        .location-entry {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }
        .location-image {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 6px;
            flex-shrink: 0;
        }
        .location-info {
            flex: 1;
        }
        .location-name-big {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin: 0 0 6px 0;
            line-height: 1.2;
        }
        .location-entry.highlighted .location-name-big {
            background-color: #ffd700;
            padding: 2px 5px;
            border-radius: 3px;
        }
        .location-address {
            font-size: 12px;
            color: #666;
            margin: 0 0 4px 0;
            line-height: 1.3;
        }
        .location-address a {
            color: #666;
            text-decoration: none;
        }
        .location-address a:hover {
            color: #007bff;
            text-decoration: underline;
        }
        .location-ig {
            font-size: 11px;
            color: #888;
            margin: 0;
            line-height: 1.3;
        }
        .location-ig a {
            color: #e4405f;
            text-decoration: underline;
        }
        .location-ig a:hover {
            color: #c13584;
            text-decoration: underline;
        }
        .location-separator {
            border: none;
            border-top: 1px solid #ddd;
            margin: 15px 0;
        }
        .map-layout {
            display: flex;
            gap: 20px;
            margin: 30px auto;
            max-width: 1400px;
            padding: 0 20px;
            justify-content: center;
        }

        /* Responsive breakpoints for laptops */
        @media screen and (max-width: 1366px) {
            .map-rectangle {
                width: 58%;
            }

            .igs-rectangle {
                width: 38%;
            }

            .top-left-logo {
                height: 100px;
                top: 60px;
            }
        }

        @media screen and (max-width: 1024px) {
            .map-layout {
                flex-direction: column;
                align-items: center;
                gap: 30px;
            }

            .map-rectangle {
                width: 90%;
                max-width: none;
            }

            .igs-rectangle {
                width: 90%;
                max-width: none;
                height: 500px;
            }

            .top-left-logo {
                height: 80px;
                top: 50px;
            }

            #main-heading {
                font-size: 28px;
            }
        }
    </style>
</head>
<body>
	<div class="top-bar"></div>
	<nav class="menu-bar">
		<div class="menu-container">
			<a href="index.html" class="menu-item">Home</a>
			<a href="#about" class="menu-item">About</a>
			<a href="#events" class="menu-item">Events</a>
			<a href="#contact" class="menu-item">Contact</a>
			<a href="https://www.eventbrite.com/o/ri-food-fights-1718820104" target="_blank" class="menu-item">Tickets</a>
		</div>
	</nav>
	<div class="content">
		<div class="main-content">
			<a href="index.html"><img src="imgs/rifflogo.jpg" alt="RIFF Logo" class="top-left-logo"></a>
			<div class="map-layout">
				<div class="map-rectangle">
					<div id="map"></div>
					<button class="toggle-button" onclick="toggleMapView()" id="mapToggle">Toggle View</button>
				</div>
				<div class="igs-rectangle">
					<div class="location-list" id="location-list"></div>
				</div>
			</div>
		</div>
	</div>

	<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
	<script>
		// Load locations from references.json
		let locations = [];
		let map;

		// Initialize and load everything
		async function initializeMap() {
			try {
				const response = await fetch('references.json');
				if (!response.ok) {
					throw new Error(`HTTP error! status: ${response.status}`);
				}
				const data = await response.json();

				// Map filenames to full paths
				locations = data.locations.map(loc => ({
					...loc,
					image: `imgs/listpics/${loc.image}`
				}));

				// Initialize map centered on Rhode Island
				map = L.map('map').setView([41.5801, -71.4774], 10);

				setupMap();
			} catch (error) {
				console.error('Error loading locations:', error);
				console.error('IMPORTANT: You must run a local web server or deploy to GitHub Pages.');
			}
		}

		// Setup map tiles, markers, and list
		function setupMap() {

		// Define map themes
		const mapThemes = {
			transport: {
				url: 'https://{s}.tile.thunderforest.com/transport/{z}/{x}/{y}.png?apikey=6170aad10dfd42a38d4d8c709a536f38',
				attribution: '¬© Thunderforest, ¬© OpenStreetMap contributors',
				maxZoom: 18
			},
			satellite: {
				url: 'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
				attribution: '¬© Esri, Maxar, Earthstar Geographics',
				maxZoom: 18
			}
		};

		// Add default Transport layer
		let currentLayer = L.tileLayer(mapThemes.transport.url, {
			attribution: mapThemes.transport.attribution,
			maxZoom: mapThemes.transport.maxZoom
		}).addTo(map);

		// Track current view mode
		let currentView = 'transport';

		// Function to toggle between transport and satellite (global so HTML onclick can access)
		window.toggleMapView = function() {
			const button = document.getElementById('mapToggle');

			// Remove current layer
			map.removeLayer(currentLayer);

			if (currentView === 'transport') {
				// Switch to satellite
				currentLayer = L.tileLayer(mapThemes.satellite.url, {
					attribution: mapThemes.satellite.attribution,
					maxZoom: mapThemes.satellite.maxZoom
				}).addTo(map);
				currentView = 'satellite';
				button.textContent = 'Toggle View';
			} else {
				// Switch to transport
				currentLayer = L.tileLayer(mapThemes.transport.url, {
					attribution: mapThemes.transport.attribution,
					maxZoom: mapThemes.transport.maxZoom
				}).addTo(map);
				currentView = 'transport';
				button.textContent = 'Toggle View';
			}
		};

		// Create custom marker icons (normal and selected)
		const locationIcon = L.divIcon({
			className: 'custom-location-icon',
			html: '<div style="background-color: #dc3545; width: 20px; height: 20px; border-radius: 50%; border: 3px solid #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 12px;">üìç</div>',
			iconSize: [26, 26],
			iconAnchor: [13, 13]
		});

		const selectedIcon = L.divIcon({
			className: 'custom-location-icon',
			html: '<div style="background-color: #ffd700; width: 24px; height: 24px; border-radius: 50%; border: 4px solid #fff; box-shadow: 0 4px 12px rgba(255,215,0,0.6); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 14px;">üìç</div>',
			iconSize: [32, 32],
			iconAnchor: [16, 16]
		});

		// Track currently selected marker
		let selectedMarker = null;

		// Add markers for each location
		const markers = [];
		locations.forEach((location, index) => {
			const marker = L.marker([location.lat, location.lng], {icon: locationIcon}).addTo(map);
			markers.push(marker);

			// Add click handler to highlight corresponding list entry
			marker.on('click', function() {
				// Reset previously selected marker
				if (selectedMarker) {
					selectedMarker.setIcon(locationIcon);
				}

				// Set new selected marker
				selectedMarker = marker;
				marker.setIcon(selectedIcon);

				// Remove highlight from all entries
				document.querySelectorAll('.location-entry').forEach(entry => {
					entry.classList.remove('highlighted');
				});
				// Highlight the clicked location
				const listEntry = document.getElementById(`location-${index}`);
				if (listEntry) {
					listEntry.classList.add('highlighted');
					// Scroll to the entry
					listEntry.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
				}
			});
		});

		// Fit map to show all markers
		const group = new L.featureGroup(locations.map(loc =>
			L.marker([loc.lat, loc.lng])
		));
		map.fitBounds(group.getBounds().pad(0.1));

		// Populate location list
		const locationListDiv = document.getElementById('location-list');
		let content = '';
		locations.forEach((location, index) => {
			const mapsUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(location.name + ' ' + location.address)}`;
			const igHandle = location.instagram.replace('@', '');
			const igUrl = `https://instagram.com/${igHandle}`;
			const displayHandle = location.instagram.startsWith('@') ? location.instagram : '@' + location.instagram;

			content += `<div class="location-entry" id="location-${index}" style="cursor: pointer;">`;
			content += `<img src="${location.image}" alt="${location.name}" class="location-image">`;
			content += `<div class="location-info">`;
			content += `<div class="location-name-big">${location.name}</div>`;
			content += `<div class="location-address"><a href="${mapsUrl}" target="_blank">${location.address}</a></div>`;
			content += `<div class="location-ig">Instagram: <a href="${igUrl}" target="_blank">${displayHandle}</a></div>`;
			content += `</div>`;
			content += `</div>`;

			if (index < locations.length - 1) {
				content += `<hr class="location-separator">`;
			}
		});
		locationListDiv.innerHTML = content;

		// Add click handlers to list entries
		locations.forEach((location, index) => {
			const listEntry = document.getElementById(`location-${index}`);
			listEntry.addEventListener('click', function(e) {
				// Don't trigger if clicking on a link
				if (e.target.tagName === 'A') return;

				// Reset previously selected marker
				if (selectedMarker) {
					selectedMarker.setIcon(locationIcon);
				}

				// Set new selected marker
				selectedMarker = markers[index];
				markers[index].setIcon(selectedIcon);

				// Remove highlight from all entries
				document.querySelectorAll('.location-entry').forEach(entry => {
					entry.classList.remove('highlighted');
				});

				// Highlight the clicked entry
				listEntry.classList.add('highlighted');
			});
		});
	}

	// Initialize the map on page load
	initializeMap();
	</script>
</body>
</html>
